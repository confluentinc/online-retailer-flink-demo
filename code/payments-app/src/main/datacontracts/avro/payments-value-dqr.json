  {
    "metadata": {
        "tags": {
            "Sale.cc_number": [ "pci" ]
        }
    },
    "ruleSet": {
        "domainRules": [
            {
                "name": "pci_encrypt",
                "kind": "TRANSFORM",
                "mode": "WRITEREAD",
                "type": "ENCRYPT",
                "tags": ["pci"],
                "params": {
                    "encrypt.kek.name": "pci_encrypt_key",
                    "encrypt.kms.key.id": "arn:aws:kms:us-west-2:829250931565:key/c82d855d-9ec2-4fa9-9f4a-635cf619d896",
                    "encrypt.kms.type": "aws-kms"
                },
                "onFailure": "ERROR,NONE",
                "disabled": false
            },
            {
                "name": "validateConfirmationCode",
                "kind": "CONDITION",
                "mode": "WRITE",
                "type": "CEL",
                "expr": "message.confirmation_code.matches('^[A-Z0-9]{8}$')",
                "onFailure": "DLQ",
                "params": {
                    "dlq.topic": "error-payments",
                    "dlq.auto.flush": "true"
                }
            }
        ]
    }
}
